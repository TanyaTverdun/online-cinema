@using onlineCinema.Application.DTOs.Movie
@using onlineCinema.Domain.Enums
@model IEnumerable<MovieCardDto>

@{
    ViewData["Title"] = "Афіша";

    var nowShowing = Model.Where(m => m.Status == MovieStatus.Released).ToList();
    var comingSoon = Model.Where(m => m.Status == MovieStatus.ComingSoon).ToList();
    var heroMovie = nowShowing.FirstOrDefault(); 
}

@if (heroMovie != null)
{
    <section class="position-relative overflow-hidden" style="height: 75vh;">
        <div class="position-absolute w-100 h-100">
            <img src="@heroMovie.PosterUrl"
                 alt="@heroMovie.Title Фон"
                 class="w-100 h-100 object-fit-cover opacity-50"
                 style="filter: blur(4px);">
        </div>

        <div class="position-absolute top-0 start-0 w-100 h-100"
             style="background: linear-gradient(to right, #060606 0%, rgba(6,6,6,0.3) 100%);"></div>

        <div class="container position-relative h-100 d-flex align-items-center">
            <div class="col-12 col-lg-7">
                <div class="d-flex align-items-center gap-2 mb-3">
                    <span class="badge bg-danger">PREMIER</span>
                 
                    @if (heroMovie.Rating > 0)
                    {
                        <span class="badge bg-warning  border border-warning">
                            <i class="bi bi-star-fill me-1 text-white"></i>@heroMovie.Rating.ToString("0.0")
                        </span>
                    }
                </div>

                <h1 class="display-3 fw-bold text-uppercase text-white mb-3" style="text-shadow: 0 0 10px rgba(0,0,0,0.8);">@heroMovie.Title</h1>

                <p class="lead mb-4 text-white opacity-75">
                    <i class="bi bi-tags-fill me-2 text-primary"></i>@heroMovie.GenreSummary
                </p>

                <div class="d-flex gap-3">
                    <a asp-controller="Home" asp-action="Details" asp-route-id="@heroMovie.Id"
                       class="btn btn-primary btn-lg px-4">
                        <i class="bi bi-ticket-perforated me-2"></i>Купити квитки
                    </a>
                    <a asp-controller="Home" asp-action="Details" asp-route-id="@heroMovie.Id"
                       class="btn btn-outline-light btn-lg px-4">
                        Детальніше
                    </a>
                </div>
            </div>
        </div>
    </section>
}

<section class="py-5">
    <div class="container">
        <div class="d-flex justify-content-between align-items-end mb-4 border-bottom pb-2">
            <div>
                <h2 class="text-white fw-bold mb-0">У ПРОКАТІ</h2>
                <small class="text-muted">У кінотеатрах</small>
            </div>
            
        </div>

        <div class="row g-4">
            @foreach (var movie in nowShowing)
            {
                <div class="col-12 col-sm-6 col-md-4 col-lg-3">
                    <div class="card h-100 border-0 shadow-sm movie-card-hover movie-table">
                        <div class="position-relative overflow-hidden">
                            <a asp-action="Details" asp-route-id="@movie.Id">
                                <img src="@movie.PosterUrl"
                                     class="card-img-top object-fit-cover"
                                     alt="@movie.Title"
                                     style="height: 400px; transition: transform 0.3s;">
                            </a>

                            <span class="badge bg-danger position-absolute top-0 end-0 m-2 shadow fs-6">
                                @movie.AgeRating+
                            </span>

                            <span class="badge bg-black bg-opacity-75 position-absolute top-0 start-0 m-2 shadow small">
                                @movie.ReleaseYear
                            </span>

                          
                            @if (movie.Rating > 0)
                            {
                                <div class="position-absolute bottom-0 end-0 m-2">
                                    <span class="badge    d-flex align-items-center gap-1">
                                        <i class="bi bi-star-fill" style="font-size: 0.8rem;"></i>
                                        <span class="fw-bold text-white">@movie.Rating.ToString("0.0")</span>
                                    </span>
                                </div>
                            }
                        </div>
                        <div class="card-body">
                            <h5 class="card-title text-truncate fw-bold text-white">@movie.Title</h5>
                            <p class="card-text text-muted small mb-3">
                                @movie.GenreSummary
                            </p>
                            <div class="mb-3">
                                @foreach (var feature in movie.Features.Take(3))
                                {
                                    <span class="badge bg-secondary bg-opacity-25 text-white me-1 border border-secondary border-opacity-25" style="font-size: 0.7em;">
                                        @feature
                                    </span>
                                }
                            </div>
                            <a asp-action="Details" asp-route-id="@movie.Id"
                               class="btn btn-sm btn-primary w-100">
                                Купити квиток
                            </a>
                        </div>
                    </div>
                </div>
            }
            @if (!nowShowing.Any())
            {
                <div class="col-12 text-center py-5 text-muted">Наразі немає фільмів у прокаті.</div>
            }
        </div>
    </div>
</section>

<section class="py-5 bg-opacity-10 bg-secondary">
    <div class="container">
        <div class="d-flex align-items-center mb-4">
            <h2 class="text-white fw-bold border-start border-4 border-warning ps-3">СКОРО У ПРОКАТІ</h2>
        </div>

        <div class="row g-4">
            @foreach (var movie in comingSoon)
            {
                <div class="col-12 col-sm-6 col-md-4 col-lg-3">
                    <div class="card h-100 border-secondary">
                        <div class="position-relative">
                            <img src="@movie.PosterUrl"
                                 class="card-img-top opacity-75"
                                 alt="@movie.Title"
                                 style="height: 400px; object-fit: cover; filter: grayscale(80%);">

                           
                            @if (movie.Rating > 0)
                            {
                                <span class="badge bg-warning position-absolute top-0 end-0 m-2 shadow">
                                    <i class="bi bi-star-fill me-1"></i>@movie.Rating.ToString("0.0")
                                </span>
                            }

                            <div class="position-absolute top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center">
                                <span class="badge bg-warning text-dark fs-6 shadow">СКОРО У ПРОКАТІ</span>
                            </div>
                        </div>
                        <div class="card-body">
                            <h5 class="card-title text-truncate">@movie.Title</h5>
                            <p class="card-text text-muted small">@movie.GenreSummary</p>
                        </div>
                    </div>
                </div>
            }
            @if (!comingSoon.Any())
            {
                <div class="col-12 text-center py-5 text-muted">Немає найближчих прем’єр.</div>
            }
        </div>
    </div>
</section>

<style>
    .movie-card-hover:hover img {
        transform: scale(1.05);
    }

    .movie-card-hover img {
        transition: transform 0.3s ease;
    }
</style>
